<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Add Invoice | RemindFlow</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Styles -->
    <link rel="stylesheet" href="/css/add-invoice.css?v=2026-01-29" />
  </head>
  <body>
    <div class="container">
      <button class="back-btn" onclick="history.back()">‚Üê Back</button>

      <h2>Create Invoice</h2>

      <!-- Invoice ID (Optional) -->
      <label>Invoice ID (optional)</label>
      <input type="text" id="invoiceIdInput" placeholder="INV-XXXX" />

      <!-- Client Selection -->
      <label>Client *</label>
      <div class="client-select">
        <input
          type="text"
          id="clientSearch"
          placeholder="Search or select client"
          autocomplete="off"
          required
        />

        <button
          id="changeClientBtn"
          type="button"
          class="change-client-btn"
          style="display: none"
        >
          Change
        </button>

        <button
          class="add-client-btn"
          type="button"
          onclick="location.href='/add-client.html'"
        >
          + Add Client
        </button>
      </div>

      <ul id="clientDropdown" class="dropdown"></ul>

      <!-- Invoice Meta -->
      <div class="row">
        <div>
          <label>Invoice Date *</label>
          <input type="date" id="invoiceDate" required />
        </div>
        <div>
          <label>Due Date *</label>
          <input type="date" id="dueDate" required />
        </div>
      </div>

      <!-- Line Items -->
      <h3>Invoice Items</h3>

      <!-- ‚úÖ SINGLE HEADER (ONCE ONLY) -->
      <div class="items-header invoice-items-grid">
        <span>Description</span>
        <span>Qty</span>
        <span>Rate</span>
        <span></span>
      </div>

      <!-- JS renders items here -->
      <div id="itemsContainer"></div>

      <button
        type="button"
        id="addItemBtn"
        class="secondary-btn add-item-btn"
      >
        + Add Item
      </button>

      <!-- ‚úÖ TAX (CANONICAL, SETTINGS-DRIVEN) -->
      <h3>Tax (optional)</h3>

      <div class="items-header invoice-items-grid">
        <span>Tax Name</span>
        <span>Rate (%)</span>
        <span></span>
      </div>

      <div id="taxesContainer"></div>

      <!-- üü¢ DISCOUNT (FLEXIBLE) -->
      <h3>Discount (optional)</h3>

      <div class="row">
        <div>
          <label>Discount Type</label>
          <select id="discountType">
            <option value="flat">Flat Amount (‚Çπ)</option>
            <option value="percentage">Percentage (%)</option>
          </select>
        </div>

        <div>
          <label>Discount Value</label>
          <input
            type="number"
            id="discountValue"
            step="0.01"
            placeholder="0"
          />
        </div>
      </div>

      <!-- Payment Options -->
      <h3>Payment Options</h3>
      <label class="checkbox-row">
        <input type="checkbox" id="enableRazorpay" />
        Enable online payment via Razorpay
      </label>

      <!-- Template -->
      <label>Invoice Template *</label>
      <select id="layoutSelect" required>
        <option value="">Select template</option>
        <option value="minimal">Minimal</option>
        <option value="professional">Professional</option>
        <option value="modern">Modern</option>
      </select>

      <!-- Notes -->
      <label>Notes (optional)</label>
      <textarea id="notes"></textarea>

      <button class="primary-btn" id="continueBtn">
        Continue ‚Üí Preview
      </button>
    </div>

    <!-- Auth Guard -->
    <script type="module">
      import { requireAuth } from "/js/guard.js";
      requireAuth();
    </script>

    <!-- Page Logic -->
    <script type="module" src="/js/add-invoice.js?v=2026-01-29"></script>
  </body>
</html>

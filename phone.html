<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Verify Phone â€“ RemindFlow</title>
  <link rel="stylesheet" href="/css/phone.css" />
</head>
<body>
  <nav class="navbar">
    <div class="logo">RemindFlow</div>
  </nav>

  <main class="verification-container">
    <h1>Verify Your Phone Number</h1>
    <p class="subtitle">For security and trial protection, please verify your phone number.</p>

    <div class="verification-box">
      <!-- Step 1: Enter phone -->
      <div id="step-enter">
        <input type="tel" id="phone" placeholder="Enter your phone number" />
        <button id="sendOtpBtn" class="action-btn">Send OTP</button>
      </div>

      <!-- Step 2: Enter OTP -->
      <div id="step-otp" style="display:none;">
        <input type="text" id="otp" placeholder="Enter 6-digit OTP" maxlength="6" />
        <button id="verifyOtpBtn" class="action-btn">Verify OTP</button>
        <p class="resend" id="resendOtp">Resend OTP</p>
      </div>
    </div>
  </main>

  <!-- JS module -->
  <script type="module">
    const API_BASE = window.REMINDFLOW_API_BASE || "";

    const stepEnter = document.getElementById("step-enter");
    const stepOtp = document.getElementById("step-otp");

    const sendOtpBtn = document.getElementById("sendOtpBtn");
    const verifyOtpBtn = document.getElementById("verifyOtpBtn");
    const resendOtp = document.getElementById("resendOtp");

    async function sendOTP() {
      const phone = document.getElementById("phone").value.trim();
      if (!phone || phone.length < 10) {
        alert("Enter a valid phone number");
        return;
      }

      try {
        const res = await fetch(`${API_BASE}/api/auth/send-otp`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ phone }),
        });
        const data = await res.json();

        if (data.success) {
          stepEnter.style.display = "none";
          stepOtp.style.display = "block";
        } else {
          alert(data.message);
        }
      } catch (err) {
        console.error(err);
        alert("Error sending OTP. Try again.");
      }
    }

    async function verifyOTP() {
      const otp = document.getElementById("otp").value.trim();
      if (!otp || otp.length !== 6) {
        alert("Enter the 6-digit OTP");
        return;
      }

      try {
        const res = await fetch(`${API_BASE}/api/auth/verify-otp`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ otp }),
        });
        const data = await res.json();

        if (data.success) {
          window.location.href = "/plans";
        } else {
          alert(data.message);
        }
      } catch (err) {
        console.error(err);
        alert("Error verifying OTP. Try again.");
      }
    }

    // Event listeners
    sendOtpBtn.addEventListener("click", sendOTP);
    verifyOtpBtn.addEventListener("click", verifyOTP);
    resendOtp.addEventListener("click", sendOTP);
  </script>
</body>
</html>
